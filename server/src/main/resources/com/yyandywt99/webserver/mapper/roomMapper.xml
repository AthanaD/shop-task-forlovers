<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.yyandywt99.webserver.mapper.roomMapper">
    <sql id="select">
        select produceId,
               founderId,
               produceName,
               produceText,
               produceImage,
               produceNum,
               checkProduce,
               useName,
               updateTime,
               registerTime
        from roomtable
    </sql>
    <insert id="addRoom">
        INSERT IGNORE INTO roomtable (
                                      <if test="produceId != null">
                                        produceId,
                                      </if>
                                      founderId,
                                      produceName,
                                      produceText,
                                      produceImage,
                                      produceNum,
                                      checkProduce,
                                      useName,
                                      updateTime,
                                      registerTime
                                      )
        VALUES (
                <if test="produceId != null">#{produceId},</if>
                #{founderId},
                #{produceName},
                #{produceText},
                #{produceImage},
                #{produceNum},
                #{checkProduce},
                #{useName},
                now(),
                now()
               )
        ON DUPLICATE KEY UPDATE produceNum = roomtable.produceNum + 1,
                                updateTime = now();

    </insert>
    <update id="reduceRoom">
        update roomtable set produceNum = produceNum - 1 ,
                             updateTime = now()
        where produceId = #{id};
    </update>
    <delete id="deleteRoom">
        delete
        from roomtable
        where produceId = #{id}
    </delete>

    <select id="selectNoRoom" resultType="com.yyandywt99.webserver.pojo.room">
        <include refid="select"></include>
        where produceName like CONCAT('%', #{name}, '%') and produceNum > 0 and checkProduce = 0
        ORDER BY updateTime DESC;
    </select>
    <select id="selectYesRoom" resultType="com.yyandywt99.webserver.pojo.room">
        <include refid="select"></include>
        where produceName like CONCAT('%', #{name}, '%')
        and produceNum > 0
        and checkProduce = 1
        ORDER BY updateTime DESC;
    </select>
    <select id="idSelectRoom" resultType="java.lang.Integer">
        select produceNum from roomtable
        where produceId = #{id};
    </select>
    <select id="selectId" resultType="java.lang.Integer">
        SELECT produceId FROM roomtable
        ORDER BY updateTime DESC
        LIMIT 1;
    </select>
</mapper>